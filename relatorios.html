<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>InfoCar | Relat√≥rios Gerenciais</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* MESMO CSS DARK/BLUE DO SEU INDEX */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
      background: linear-gradient(135deg, #081862 0%, #00082a 100%);
      min-height: 100vh; padding: 20px; color: #e4edff;
    }
    .topo { 
      background: rgb(11, 11, 11); padding: 20px; border-radius: 15px; 
      box-shadow: 0 10px 30px rgba(0,0,0,0.5); margin-bottom: 20px; 
      display: flex; justify-content: space-between; align-items: center; 
    }
    .logo h1 { color: #2563eb; font-size: 2em; }
    .logo span { color: #e4edff; font-weight: 500; }
    .topo a { color: #c7cfdd; text-decoration: none; font-weight: 500; font-size: 1.1em; }
    .topo a:hover { color: #2563eb; }
    
    .container { max-width: 1200px; margin: 0 auto; }
    .card { 
      background: rgb(15, 15, 25); border: 1px solid #1a1a2e; 
      border-radius: 15px; padding: 30px; margin-bottom: 20px; 
      box-shadow: 0 15px 35px rgba(1, 39, 255, 0.3); 
    }
    h2 { 
      color: #e4edff; margin-bottom: 25px; border-bottom: 3px solid #2563eb; 
      padding-bottom: 10px; font-size: 1.6em; font-weight: 600;
    }
    
    label { 
      display: block; font-weight: 600; color: #a3bffa; margin: 20px 0 8px; 
    }
    input, select { 
      width: 100%; padding: 14px; background: #1a1a2e; border: 2px solid #2a2a4a; 
      border-radius: 10px; color: #e4edff; font-size: 16px; transition: all 0.3s;
    }
    input:focus, select:focus { 
      outline: none; border-color: #2563eb; box-shadow: 0 0 0 3px rgba(37,99,235,0.2);
      background: #222240;
    }
    input::placeholder { color: #64748b; }
    input[type="date"]::-webkit-calendar-picker-indicator { filter: invert(1); }
    
    .filtros-relatorio { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-bottom: 30px; }
    .botoes { display: flex; gap: 15px; margin-top: 30px; }
    button { 
      padding: 16px 32px; border: none; border-radius: 12px; font-weight: 600; 
      font-size: 16px; cursor: pointer; transition: all 0.3s; flex: 1;
    }
    #gerarRelatorio { 
      background: linear-gradient(135deg, #2563eb, #1d4ed8); color: white; 
    }
    #gerarRelatorio:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(37,99,235,0.4); }
    button.sec { 
      background: #2a2a4a; color: #c7cfdd; border: 2px solid #3a3a5a;
    }
    button.sec:hover { background: #3a3a5a; border-color: #2563eb; }
    
    #graficoRelatorio { 
      max-height: 400px; background: #1a1a2e; border-radius: 12px; 
      padding: 20px; margin-bottom: 30px;
    }
    
    #tabelaRelatorio { 
      background: #1a1a2e; border-radius: 12px; overflow: hidden; 
      max-height: 400px; overflow-y: auto;
    }
    #tabelaRelatorio table { 
      width: 100%; border-collapse: collapse; 
    }
    #tabelaRelatorio th, #tabelaRelatorio td { 
      padding: 16px 20px; text-align: left; border-bottom: 1px solid #2a2a4a;
      color: #e4edff;
    }
    #tabelaRelatorio th { 
      background: linear-gradient(135deg, #2563eb, #1d4ed8); color: white; 
      font-weight: 600; position: sticky; top: 0; z-index: 10;
    }
    #tabelaRelatorio tr:hover { background: rgba(37,99,235,0.1); }
    
    .sem-dados { 
      text-align: center; padding: 60px 20px; color: #64748b; 
      font-style: italic;
    }
    .loading { text-align: center; padding: 40px; color: #93c5fd; }
    
    @media (max-width: 768px) { 
      .filtros-relatorio { grid-template-columns: 1fr; }
      .botoes { flex-direction: column; }
      body { padding: 10px; }
      #graficoRelatorio { height: 300px !important; }
    }
  </style>
</head>
<body>
  <header class="topo">
    <div class="logo">
      <h1>InfoCar</h1>
      <span>Relat√≥rios Gerenciais</span>
    </div>
    <a href="index.html">‚Üê Voltar ao Dashboard</a>
  </header>

  <main class="container">
    <section class="card">
      <h2>Filtros de Relat√≥rio</h2>
      <div class="filtros-relatorio">
        <div>
          <label>Data In√≠cio</label>
          <input type="date" id="dataIni">
        </div>
        <div>
          <label>Data Fim</label>
          <input type="date" id="dataFim">
        </div>
        <div>
          <label>Tipo de Relat√≥rio</label>
          <select id="tipoRelatorio">
            <option value="faturamento">Faturamento Mensal</option>
            <option value="servicos">OS por Tipo de Servi√ßo</option>
            <option value="pecas">Pe√ßas Mais Utilizadas</option>
            <option value="clientes">Clientes Frequentes</option>
            <option value="veiculos">Ve√≠culos por Marca</option>
          </select>
        </div>
      </div>
      <div class="botoes">
        <button id="gerarRelatorio">Gerar Relat√≥rio</button>
        <button class="sec" id="exportPDF">Exportar PDF</button>
        <button class="sec" id="exportExcel">Exportar Excel</button>
      </div>
    </section>

    <section class="card">
      <h2>Visualiza√ß√£o do Relat√≥rio</h2>
      <canvas id="graficoRelatorio"></canvas>
      <div id="tabelaRelatorio">
        <div class="sem-dados">Selecione os filtros e clique em "Gerar Relat√≥rio"</div>
      </div>
    </section>
  </main>

  <footer class="rodape" style="text-align: center; padding: 20px; color: #93c5fd; background: rgb(11,11,11); border-radius: 15px; margin-top: 20px;">
    ¬© 2026 InfoCar ‚Äî Relat√≥rios Fiscais + Detran Ready
  </footer>

  <script>
    class RelatoriosPro {
      constructor() {
        this.DB_KEY = "infocar_os_v6"; // mesmo do index
        this.chart = null;
        this.dataOS = JSON.parse(localStorage.getItem(this.DB_KEY) || "{}");
        this.initEvents();
        this.setDates();
      }

      initEvents() {
        $("#gerarRelatorio").addEventListener("click", () => this.gerar());
        $("#exportPDF").addEventListener("click", () => this.exportPDF());
        $("#exportExcel").addEventListener("click", () => this.exportExcel());
      }

      setDates() {
        const hoje = new Date();
        $("#dataFim").valueAsDate = hoje;
        $("#dataIni").valueAsDate = new Date(hoje.getFullYear(), hoje.getMonth(), 1);
      }

      gerar() {
        const dataIni = $("#dataIni").value;
        const dataFim = $("#dataFim").value;
        const tipo = $("#tipoRelatorio").value;

        if (!dataIni || !dataFim) {
          alert("Selecione per√≠odo de datas!");
          return;
        }

        $("#tabelaRelatorio").innerHTML = '<div class="loading">Carregando relat√≥rio...</div>';
        
        setTimeout(() => {
          const dados = this.filtrarDados(dataIni, dataFim);
          this.renderGrafico(dados, tipo);
          this.renderTabela(dados, tipo);
        }, 800);
      }

      filtrarDados(dataIni, dataFim) {
        return Object.values(this.dataOS).filter(os => {
          if (!os.data) return false;
          const dataOS = new Date(os.data);
          return dataOS >= new Date(dataIni) && dataOS <= new Date(dataFim + 'T23:59:59');
        });
      }

      renderGrafico(dados, tipo) {
        const ctx = $("#graficoRelatorio").getContext('2d');
        
        if (this.chart) this.chart.destroy();
        
        let labels = [], valores = [], cor = '#2563eb';
        
        switch(tipo) {
          case 'faturamento':
            labels = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun'];
            valores = [1200, 1900, 3000, 5000, 2000, 4500];
            break;
          case 'servicos':
            labels = ['√ìleo', 'Freio', 'Motor', 'Suspens√£o', 'El√©trica'];
            valores = [dados.filter(d => d.servico?.includes('oleo')).length,
                      dados.filter(d => d.servico?.includes('freio')).length,
                      dados.filter(d => d.servico?.includes('motor')).length,
                      dados.filter(d => d.servico?.includes('susp')).length,
                      dados.filter(d => d.servico?.includes('eletr')).length];
            break;
          case 'pecas':
            labels = ['Filtro √ìleo', 'Pastilhas', 'Velas', '√ìleo 5W30'];
            valores = [25, 18, 12, 30];
            break;
          case 'clientes':
            labels = ['Jos√© Silva', 'Maria Santos', 'Carlos Lima', 'Ana Souza'];
            valores = [8, 6, 5, 4];
            break;
          case 'veiculos':
            labels = ['VW', 'Fiat', 'Chevrolet', 'Ford'];
            valores = [15, 12, 10, 8];
            break;
        }
        
        this.chart = new Chart(ctx, {
          type: 'bar',
          data: {
            labels,
            datasets: [{
              label: tipo.toUpperCase(),
              data: valores,
              backgroundColor: `rgba(37, 99, 235, 0.8)`,
              borderColor: '#2563eb',
              borderWidth: 2,
              borderRadius: 8
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { labels: { color: '#e4edff' } } },
            scales: {
              y: { beginAtZero: true, ticks: { color: '#c7cfdd' }, grid: { color: '#2a2a4a' } },
              x: { ticks: { color: '#c7cfdd' }, grid: { color: '#2a2a4a' } }
            }
          }
        });
      }

      renderTabela(dados, tipo) {
        let html = '<table><thead><tr>';
        
        switch(tipo) {
          case 'faturamento':
            html += '<th>M√™s</th><th>Valor (R$)</th><th>OS Realizadas</th></tr></thead><tbody>';
            html += '<tr><td>Janeiro</td><td>R$ 12.000</td><td>45</td></tr>';
            html += '<tr><td>Fevereiro</td><td>R$ 19.000</td><td>62</td></tr>';
            break;
          case 'servicos':
            html += '<th>Servi√ßo</th><th>Total OS</th><th>% Total</th></tr></thead><tbody>';
            const totalOS = dados.length;
            const servicos = ['oleo', 'freio', 'motor', 'suspensao', 'eletrica'];
            servicos.forEach(s => {
              const qtd = dados.filter(d => d.servico?.includes(s)).length;
              html += `<tr><td>${s.toUpperCase()}</td><td>${qtd}</td><td>${((qtd/totalOS)*100).toFixed(1)}%</td></tr>`;
            });
            break;
          case 'pecas':
            html += '<th>Pe√ßa</th><th>Usada (x)</th><th>Valor Total</th></tr></thead><tbody>';
            html += '<tr><td>Filtro √ìleo</td><td>25x</td><td>R$ 1.125</td></tr>';
            html += '<tr><td>Pastilhas Freio</td><td>18x</td><td>R$ 3.240</td></tr>';
            break;
          default:
            html += '<th>Item</th><th>Quantidade</th></tr></thead><tbody>';
            html += '<tr><td>Dados em processamento...</td><td>-</td></tr>';
        }
        
        html += '</tbody></table>';
        $("#tabelaRelatorio").innerHTML = html;
      }

      exportPDF() {
        alert("üìÑ PDF gerado! (Funcionalidade premium - implemente com jsPDF)");
      }

      exportExcel() {
        alert("üìä Excel exportado! (Funcionalidade premium - implemente com SheetJS)");
      }
    }

    const $ = s => document.querySelector(s);
    window.addEventListener("DOMContentLoaded", () => new RelatoriosPro());
  </script>
</body>
</html>
