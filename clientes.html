<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>InfoCar  | CRM Clientes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* MESMO CSS DARK/BLUE DO SISTEMA */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
      background: linear-gradient(135deg, #081862 0%, #00082a 100%);
      min-height: 100vh; padding: 20px; color: #e4edff;
    }
    .topo { 
      background: rgb(11, 11, 11); padding: 24px; border-radius: 15px; 
      box-shadow: 0 10px 30px rgba(0,0,0,0.5); margin-bottom: 24px; 
      display: flex; justify-content: space-between; align-items: center; 
    }
    .logo h1 { color: #2563eb; font-size: 2.2em; font-weight: 700; }
    .logo span { color: #c7cfdd; font-weight: 500; font-size: 1.1em; }
    .topo a { 
      color: #c7cfdd; text-decoration: none; font-weight: 600; padding: 10px 20px; 
      border: 2px solid #2a2a4a; border-radius: 10px; transition: all 0.3s;
    }
    .topo a:hover { color: #2563eb; border-color: #2563eb; background: rgba(37,99,235,0.1); }
    
    .container { max-width: 1400px; margin: 0 auto; }
    .card { 
      background: rgb(15, 15, 25); border: 1px solid #1a1a2e; 
      border-radius: 15px; padding: 32px; margin-bottom: 24px; 
      box-shadow: 0 15px 35px rgba(1, 39, 255, 0.3); 
    }
    h2 { 
      color: #e4edff; margin-bottom: 28px; border-bottom: 3px solid #2563eb; 
      padding-bottom: 12px; font-size: 1.8em; font-weight: 600;
    }
    
    /* FORM CLIENTE */
    .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }
    label { 
      display: block; font-weight: 600; color: #a3bffa; margin: 20px 0 8px; 
      font-size: 0.95em;
    }
    input, textarea { 
      width: 100%; padding: 16px 20px; background: #1a1a2e; border: 2px solid #2a2a4a; 
      border-radius: 12px; color: #e4edff; font-size: 16px; transition: all 0.3s;
      font-family: inherit; resize: vertical;
    }
    input:focus, textarea:focus { 
      outline: none; border-color: #2563eb; box-shadow: 0 0 0 3px rgba(37,99,235,0.2);
      background: #222240;
    }
    input::placeholder, textarea::placeholder { color: #64748b; }
    
    .botoes { display: flex; gap: 16px; margin-top: 32px; }
    button { 
      flex: 1; padding: 18px 32px; border: none; border-radius: 12px; font-weight: 600; 
      font-size: 16px; cursor: pointer; transition: all 0.3s; font-family: inherit;
    }
    #salvarCliente { 
      background: linear-gradient(135deg, #10b981, #059669); color: white; 
    }
    #salvarCliente:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(16,185,129,0.4); }
    button.sec { 
      background: #2a2a4a; color: #c7cfdd; border: 2px solid #3a3a5a;
    }
    button.sec:hover { background: #3a3a5a; border-color: #2563eb; }
    
    /* LISTA CLIENTES */
    #buscaCliente { 
      width: 100%; padding: 16px 20px; background: #1a1a2e; border: 2px solid #2a2a4a; 
      border-radius: 12px; color: #e4edff; font-size: 16px; margin-bottom: 20px;
    }
    #buscaCliente:focus { border-color: #2563eb; box-shadow: 0 0 0 3px rgba(37,99,235,0.2); }
    
    .stats-clientes { 
      display: flex; gap: 20px; margin-bottom: 24px; flex-wrap: wrap;
    }
    .stat-item { 
      background: rgba(37, 99, 235, 0.1); padding: 12px 20px; border-radius: 10px; 
      border: 1px solid #2a2a4a; font-weight: 600;
    }
    
    #listaClientes { 
      max-height: 500px; overflow-y: auto; display: flex; flex-direction: column; gap: 16px;
    }
    .cliente-item { 
      background: rgba(37, 99, 235, 0.08); border: 1px solid #2a2a4a; 
      border-left: 4px solid #2563eb; padding: 24px; border-radius: 12px; 
      cursor: pointer; transition: all 0.3s; display: flex; justify-content: space-between;
      align-items: flex-start; gap: 16px; position: relative;
    }
    .cliente-item:hover { 
      background: rgba(37, 99, 235, 0.15); transform: translateX(4px);
      box-shadow: 0 10px 30px rgba(37,99,235,0.2);
    }
    .cliente-info { flex: 1; }
    .cliente-nome { font-weight: 700; font-size: 1.3em; color: #e4edff; margin-bottom: 8px; }
    .cliente-contato { 
      display: flex; gap: 20px; color: #c7cfdd; font-size: 0.95em; margin-bottom: 12px;
      flex-wrap: wrap;
    }
    .cliente-veiculos { 
      background: rgba(59, 130, 246, 0.1); padding: 12px; border-radius: 8px; 
      font-size: 0.9em; color: #93c5fd; max-width: 300px;
    }
    .cliente-acoes { 
      display: flex; flex-direction: column; gap: 12px; align-items: flex-end;
      min-width: 140px;
    }
    .btn-whatsapp { 
      background: linear-gradient(135deg, #25D366, #128C7E); color: white; 
      padding: 12px 20px; border-radius: 10px; font-weight: 600; text-decoration: none;
      display: flex; align-items: center; gap: 8px; transition: all 0.3s;
      font-size: 0.9em;
    }
    .btn-whatsapp:hover { 
      transform: translateY(-2px); box-shadow: 0 8px 20px rgba(37,211,102,0.4);
    }
    .btn-os { 
      background: linear-gradient(135deg, #2563eb, #1d4ed8); color: white; 
      padding: 10px 16px; border-radius: 8px; font-weight: 600; cursor: pointer;
      text-align: center; font-size: 0.85em; transition: all 0.3s;
    }
    .btn-os:hover { transform: translateY(-1px); box-shadow: 0 6px 15px rgba(37,99,235,0.4); }
    
    .sem-dados { 
      text-align: center; padding: 80px 20px; color: #64748b; 
      font-style: italic; font-size: 1.1em;
    }
    
    @media (max-width: 768px) { 
      .form-grid { grid-template-columns: 1fr; }
      .botoes { flex-direction: column; }
      .cliente-item { flex-direction: column; align-items: flex-start; }
      .cliente-acoes { width: 100%; flex-direction: row; justify-content: flex-end; }
      body { padding: 12px; }
    }
  </style>
</head>
<body>
  <header class="topo">
    <div class="logo">
      <h1>InfoCar</h1>
      <span>CRM - Gestão de Clientes VIP</span>
    </div>
    <a href="index.html">← Dashboard Executivo</a>
  </header>

  <main class="container">
    <!-- NOVO CLIENTE -->
    <section class="card">
      <h2>Novo Cadastro de Cliente</h2>
      <div class="form-grid">
        <div>
          <label for="clienteNome">Nome Completo *</label>
          <input id="clienteNome" placeholder="José da Silva Santos" required>
        </div>
        <div>
          <label for="telefone">Telefone/WhatsApp *</label>
          <input id="telefone" placeholder="(11) 99999-9999" required>
        </div>
        <div>
          <label for="email">Email (opcional)</label>
          <input type="email" id="email" placeholder="jose@email.com">
        </div>
        <div style="grid-column: 1 / -1;">
          <label for="veiculos">Veículos (placas separadas por vírgula)</label>
          <textarea id="veiculos" rows="3" placeholder="ABC1D234, XYZ9E567, MER7G890"></textarea>
        </div>
      </div>
      <div class="botoes">
        <button id="salvarCliente">Salvar Cliente VIP</button>
        <button class="sec" id="limparCliente">Limpar Formulário</button>
      </div>
    </section>

    <!-- LISTA CLIENTES -->
    <section class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
        <h2>Base de Clientes</h2>
        <div class="stats-clientes">
          <div class="stat-item" id="totalClientes">(0 clientes)</div>
        </div>
      </div>
      <input type="text" id="buscaCliente" placeholder=" Buscar por nome, telefone ou placa...">
      <div id="listaClientes">
        <div class="sem-dados">Cadastre os primeiros clientes para visualizar a base</div>
      </div>
    </section>
  </main>

  <footer class="rodape">
    © 2026 InfoCar — Histórico OS Integrado + WhatsApp Business Auto
  </footer>

  <script>
    class ClientesPro {
      constructor() {
        this.DB_KEY = "infocar_clientes_v1";
        this.DB_OS = "infocar_os_v6";
        this.clientes = JSON.parse(localStorage.getItem(this.DB_KEY) || "[]");
        this.osData = JSON.parse(localStorage.getItem(this.DB_OS) || "{}");
        this.initEvents();
        this.renderClientes();
      }

      initEvents() {
        $("#salvarCliente").addEventListener("click", () => this.salvar());
        $("#limparCliente").addEventListener("click", () => this.limpar());
        $("#buscaCliente").addEventListener("input", () => this.buscar());
      }

      salvar() {
        const cliente = {
          id: Date.now().toString(36) + Math.random().toString(36).slice(2),
          nome: $("#clienteNome").value.trim(),
          telefone: $("#telefone").value.trim().replace(/\D/g, ''),
          email: $("#email").value.trim(),
          veiculos: $("#veiculos").value.split(',').map(v => v.trim().toUpperCase()).filter(Boolean),
          dataCadastro: new Date().toLocaleString("pt-BR"),
          totalOS: 0 // será calculado
        };

        if (!cliente.nome || !cliente.telefone) {
          alert("Nome e telefone são obrigatórios!");
          return;
        }

        // Verifica duplicata por telefone
        const duplicata = this.clientes.find(c => c.telefone === cliente.telefone);
        if (duplicata) {
          if (confirm(`Cliente com este WhatsApp já existe:\n${duplicata.nome}\nAtualizar dados?`)) {
            Object.assign(duplicata, cliente);
          }
          return;
        }

        this.clientes.push(cliente);
        this.salvarDB();
        this.limpar();
        this.renderClientes();
        this.toast(" Cliente cadastrado com sucesso!");
      }

      limpar() {
        $("#clienteNome").value = "";
        $("#telefone").value = "";
        $("#email").value = "";
        $("#veiculos").value = "";
      }

      salvarDB() {
        localStorage.setItem(this.DB_KEY, JSON.stringify(this.clientes));
      }

      renderClientes(filtrados = this.clientes) {
        // Calcula total OS por cliente
        filtrados.forEach(cliente => {
          cliente.totalOS = Object.values(this.osData).filter(os => 
            os.cliente?.toLowerCase().includes(cliente.nome.toLowerCase())
          ).length;
        });

        $("#totalClientes").textContent = `(${filtrados.length} clientes)`;

        $("#listaClientes").innerHTML = filtrados.map(cliente => {
          const whatsappLink = `https://wa.me/55${cliente.telefone}`;
          return `
            <div class="cliente-item" onclick="this.classList.toggle('active')">
              <div class="cliente-info">
                <div class="cliente-nome">${cliente.nome}</div>
                <div class="cliente-contato">
                  <span> ${cliente.telefone.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3')}</span>
                  ${cliente.email ? `<span> ${cliente.email}</span>` : ''}
                  <span> ${cliente.totalOS} OS</span>
                </div>
                ${cliente.veiculos?.length ? `
                  <div class="cliente-veiculos">
                    Veículos: ${cliente.veiculos.join(', ')}
                  </div>
                ` : ''}
              </div>
              <div class="cliente-acoes">
                <a href="${whatsappLink}" target="_blank" class="btn-whatsapp">
                   WhatsApp
                </a>
                <div class="btn-os" onclick="event.stopPropagation(); window.location.href='os.html'">
                  + Nova OS
                </div>
              </div>
            </div>
          `;
        }).join('') || '<div class="sem-dados">Nenhum cliente cadastrado</div>';
      }

      buscar() {
        const termo = $("#buscaCliente").value.toLowerCase();
        const filtrados = this.clientes.filter(cliente => 
          cliente.nome.toLowerCase().includes(termo) ||
          cliente.telefone.includes(termo) ||
          cliente.veiculos?.some(v => v.toLowerCase().includes(termo))
        );
        this.renderClientes(filtrados);
      }

      toast(msg) {
        const t = document.createElement('div');
        t.textContent = msg;
        t.style.cssText = `
          position:fixed;top:24px;right:24px;background:linear-gradient(135deg,#10b981,#059669);
          color:white;padding:16px 24px;border-radius:12px;box-shadow:0 15px 35px rgba(16,185,129,0.4);
          font-weight:600;z-index:10000;transform:translateX(400px);transition:all 0.4s;
          backdrop-filter:blur(10px);
        `;
        document.body.appendChild(t);
        setTimeout(() => t.style.transform = 'translateX(0)', 100);
        setTimeout(() => t.remove(), 3500);
      }
    }

    const $ = s => document.querySelector(s);
    let clientesPro;
    window.addEventListener("DOMContentLoaded", () => {
      clientesPro = new ClientesPro();
    });
  </script>
</body>
</html>
